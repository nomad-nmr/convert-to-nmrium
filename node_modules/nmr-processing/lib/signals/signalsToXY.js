"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.signalsToXY = void 0;
const ml_array_rescale_1 = __importDefault(require("ml-array-rescale"));
const ml_array_sequential_fill_1 = __importDefault(require("ml-array-sequential-fill"));
const signalsToSpinSystem_1 = require("./simulation/signalsToSpinSystem");
const simulate1D_1 = __importDefault(require("./simulation/simulate1D"));
const splitSpinSystem_1 = require("./simulation/splitSpinSystem");
function checkForMandatory(signals) {
    for (const signal of signals) {
        if (!signal.js)
            throw new Error('There is not js');
        // if (!signal.diaID) throw new Error('There is not diaID');
        if (!signal.atoms)
            throw new Error('There is not atoms');
        for (const j of signal.js) {
            // if (!j.diaID) throw new Error('There is not diaID');
            if (!j.atoms)
                throw new Error('There is not atoms');
        }
    }
}
/**
 * Generate a spectrum from an array of singals
 */
function signalsToXY(signals, options = {}) {
    checkForMandatory(signals);
    let { frequency = 400, shape = {
        kind: 'gaussian',
    }, from = 0, to = 10, lineWidth = 1, nbPoints = 16 * 1024, maxValue = 1e8, maxClusterSize = 8, } = options;
    if (signals.length === 0) {
        return {
            x: (0, ml_array_sequential_fill_1.default)({ from, to, size: nbPoints }),
            y: Array.from(new Float64Array(nbPoints)),
        };
    }
    let spinSystem = (0, signalsToSpinSystem_1.signalsToSpinSystem)(signals);
    spinSystem.clusters = (0, splitSpinSystem_1.splitSpinSystem)(spinSystem, {
        frequency,
        maxClusterSize,
    });
    let spectrum = (0, simulate1D_1.default)(spinSystem, {
        frequency,
        from,
        to,
        nbPoints,
        lineWidth,
        shape,
    });
    if (maxValue) {
        spectrum.y = (0, ml_array_rescale_1.default)(spectrum.y, { max: maxValue });
    }
    return spectrum;
}
exports.signalsToXY = signalsToXY;
//# sourceMappingURL=signalsToXY.js.map